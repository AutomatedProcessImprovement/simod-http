FROM python:3.9-bullseye

RUN pip install --upgrade pip poetry

WORKDIR /usr/src/simod-http
ADD . .
RUN poetry install

ENV SIMOD_HTTP_DEBUG=false
ENV SIMOD_HTTP_HOST=0.0.0.0
ENV SIMOD_HTTP_PORT=8080
ENV SIMOD_HTTP_SCHEME=http
ENV SIMOD_HTTP_STORAGE_PATH=./data
ENV SIMOD_HTTP_LOGGING_LEVEL=debug
ENV SIMOD_HTTP_REQUEST_EXPIRATION_TIMEDELTA=604800
ENV SIMOD_HTTP_STORAGE_CLEANING_TIMEDELTA=300
ENV SIMOD_HTTP_SMTP_SERVER=localhost
ENV SIMOD_HTTP_SMTP_PORT=2500
ENV BROKER_URL=amqp://guest:guest@localhost:5672
ENV SIMOD_EXCHANGE_NAME='simod'
ENV SIMOD_PENDING_ROUTING_KEY='requests.status.pending'
ENV SIMOD_RUNNING_ROUTING_KEY='requests.status.running'
ENV SIMOD_FAILED_ROUTING_KEY='requests.status.failed'
ENV SIMOD_SUCCEEDED_ROUTING_KEY='requests.status.succeeded'


EXPOSE $SIMOD_HTTP_PORT

CMD ["bash", "run.sh"]
